{"id":"a57e3aa1-26a3-43f8-bfb7-4a881133b6d0","timestamp":"2025-08-26T03:06:11.720Z","instructions":"# Global AGENT Guidance\n\n## Language Policy\n- Always respond in Japanese.（常に日本語で応答してください）\n\n## 基本方針\n\n## 1. コーディング規約（React/TypeScript）\n\n### コンポーネント\n- **arrow function を使用**（function 宣言は原則不使用）\n- **props は展開しない**（不要な `...props` の横流し禁止）\n- **型定義は `type` を使用**（`interface` は不使用。外部ライブラリとの統合時のみ例外）\n- **`any` は使用禁止**（必要なら明示的な型設計を行う）\n- React Hooks は **名前付きインポート**（`React.useState` などの `React.` プレフィックスは不使用）\n- props の型は **インラインで記述**（再利用時のみ `type` を定義）\n- **`forwardRef` は使用しない**（外部ライブラリとの統合時のみ例外）\n- props は **`props.xxx` として明示的に参照**する（分割代入は必要時のみ最小限）\n\n### コード構造\n- **return は最小限に**（単一 return 推奨。複数行は可）\n- **早期リターン禁止・ガードブロック推奨**：`if (!cond) return` は使用せず、`if (cond) { /* 処理 */ }` で包む\n- 条件分岐は **`&&` を優先**（三項は原則不使用。必要時のみ可）\n- 変数/関数は **再利用しないものはインライン**で記述\n- 一度きりのスタイルオブジェクトは **インライン**で指定\n- 一度きりの小関数/定数も **インライン**で記述\n- コンポーネント分割は **過剰に行わない**（責務が明確な場合のみ）\n- ファイル内ローカルのマッピング/補助ロジックは **`__` プレフィックス**で関数に切り出し、**ファイル最下部**に配置\n\n### 一時変数の取り扱い\n- **単回利用の一時変数は作らずインライン化する**\n- 再利用や明確な可読性向上の根拠がない一時変数の導入を禁止\n- **例外**: 値が変わる可能性があるもの（`ref.current`、非同期処理間の状態など）は安全のため一時変数で保持\n\n### コード品質基準\n- 型定義は **インライン化**（別定義は削除。再利用時のみ `type` 定義）\n- 重複パターンは **オブジェクトリテラル**で統合\n- コンポーネントは **単一の return 文**に収束\n- 条件分岐は **オブジェクトインデックス**で置換できないか検討\n\n## 2. 命名規則\n\n### 基本原則（役割優先・ドメイン後置）\n- 役割を先頭に置く（例: state, set, ref, id, key, on/handle, get/add/update/remove）\n- ドメイン名はその後ろに続ける（例: `stateUser`, `refSvg`, `idUser`, `onUserClick`）\n\n### 具体的な命名\n- `useState`: `stateXXX`, `setXXX`（リアクティブな値であることを明示）\n- `useRef`: `refXXX`（カスタムコンポーネントで参照を渡す場合も `refXxx` 形式）\n- 反復処理コールバック（forEach/map/reduce など）の引数は **1–2 文字**（例: `p`, `i`）\n- ドメイン関数: 動詞ベース（例: `get`, `getById`, `add`, `update`, `remove`）\n- ページ/レイアウトの変数名: ページは **`Page`**、レイアウトは **`Layout`** に統一（default export）\n\n## 3. ファイル/フォルダ構成\n\n### App Router の構成\n- 各ページ配下構成（RSC + Client 分離）\n- `page.tsx` は RSC のままに保つ（\"use client\" は付与しない）\n- クライアント側ロジックは `_Client/` へ分離\n- 1 回しか使わない子は **`_` プレフィックス**（例: `_DialogEdit.tsx`）\n\n### レイアウト（トップレベル）\n- `app/layout.tsx` は `<main>` ランドマークで `children` をラップ\n- `<main>` はアプリ全体で一意。ページ（`page.tsx`）側では `<main>` を使用しない\n- トップページ関連は `app/(home)` に集約\n\n### 命名・エクスポート\n- コンポーネント名はパスカルケース\n- 単回利用の子は `_` プレフィックスを付ける\n\n### import / エイリアス\n- `@` は **プロジェクトルート**を指す（`tsconfig.json` の `paths` に準拠）\n- React Hooks は **名前付きインポート**（例: `import { useEffect } from \"react\";`）\n\n## 4. DOM 操作・Motion 統合ルール\n\n### DOM 操作で try/catch を使わない\n- DOM 操作時に `try { … } catch { … }` は使用しない\n- 代わりにガード節での存在確認（例: `if (el) { /* 処理 */ }`）\n- 型の絞り込み（`useRef<HTMLElement | null>` などの適切な型）\n- 例外を握りつぶすような `catch {}` は禁止\n\n### DOM参照ポリシー（IDとrefの使い分け）\n- 単一コンポーネント内のみで完結する一時的な参照: React の `ref` を使用\n- 複数回使う/ページやコンポーネントをまたいで参照・制御する要素: `id`（`app/motion.ts` の ID 管理）を使用\n- 記法ルール: `ref.current` は値が変わる可能性があるため、必ず 1–2 文字の一時変数に代入してから null チェック・使用する\n\n### Motion API 利用規約\n- `@soichiro_nitta/motion` を使用\n- 変化は基本 `transform`/`opacity`（例: `scale`, `translateY`, `rotate`, `opacity`）に限定\n- `motion.delay(sec)` は「待機のみ」を行う。常に `await` を付けて非同期フロー内で使用\n- `setTimeout`/`setInterval` は使用しない（待機は `motion.delay` に統一）\n\n### Motion のプロパティ指定ルール\n- `motion.set` / `motion.to` に、CSS 複合プロパティの `transform` は渡さない\n- 変形は必ず個別キーで指定（`translateX`, `translateY`, `scale`, `rotate` など）\n- 数値・角度・長さは単位付きの文字列で指定（例: `'61px'`, '120deg'`, `'1'`）\n\n### Motion の ID 定義と要素アクセス\n- Motion の ID 管理と DOM 要素アクセスは `ID.XXX.E()` を用いる\n- `querySelector` / `getElementById` 等の直接参照は原則使用しない\n- 存在ガード: DOM 操作前に `const el = ID.XXX.E(); if (el) { /* 処理 */ }` でガード節を使用\n\n## 5. スタイル管理\n\n### コンポーネント内共通スタイル\n- 共通スタイルはファイル内ローカルの `__style` オブジェクトに集約\n- `__style` の各プロパティ名は簡潔に（例: `img`, `wrap`, `title`, `desc`）\n- クラス合成は `class-variance-authority` の `cva` / `cx` を使用\n- `cx` の条件分岐はオブジェクト記法を用いる\n\n### ページ内共通化の方針\n- スタイルのみを切り出す場合: ファイルローカルの `__style` オブジェクトに `cva` で定義\n- 構造やロジックごと共通化する場合: ページ内ローカルコンポーネント `__Component` を作成\n\n## 6. Next.js 固有ルール\n\n### next/image を使用しない\n- Next.js の `next/image` を使用しない\n- 代わりに標準の `<img>` を使用\n- アクセシビリティのため、`alt` は必須\n\n## 7. パッケージ管理\n\n### パッケージマネージャ（pnpm固定）\n- このワークスペースでは **常に pnpm** を使用\n- npm / yarn は使用しない\n- 依存追加は `pnpm add`、開発依存は `pnpm add -D`、インストールは `pnpm install`\n\n## 8. ESLint/Prettier 設定方針\n\n### ESLint\n- ESLint は Flat Config（`eslint.config.mjs`）を使用\n- `@next/next/no-img-element` はオフ\n- import 並び順は `import/order` でアルファベット昇順、グループ単位に改行\n- React Hooks の `rules-of-hooks` は off、`exhaustive-deps` は warn\n- TypeScript は `no-explicit-any: warn`、`consistent-type-imports: error`、`no-unused-vars: warn`\n\n### 特殊制約ルール\n- `**/app/**/page.{js,jsx,ts,tsx}` では `\"use client\"` を禁止（RSC保持）\n- Client → Server/Page の直 import を禁止\n- TS ファイルから `page.tsx` への直 import を禁止\n\n### Prettier\n- `prettier-plugin-tailwindcss` を使用\n- セミコロンなし、シングルクォート使用、トレイリングカンマあり\n\n## 9. コミットメッセージ\n\n### 日本語でのコミットメッセージ\n- コミットメッセージは **原則すべて日本語** で記述\n- 形式は **Conventional Commits** を推奨：`type(scope)?: subject`\n- `subject` は **日本語で簡潔に**（末尾の句点は不要、50文字目安）\n- 例：`feat: ホームページのヒーローセクションを追加`\n\n## 10. Convex 命名規則\n\n- CRUD: `get`, `getById`, `add`, `update`, `remove`\n- 関数名に **ドメイン名は含めない**（例: `api.transactions.updateStatus` のように使用）\n\n## 禁止事項\n\n- `page.tsx` に \"use client\" を付与しない\n- 不要な `...props` の横流しを行わない\n- トップページ専用の要素を `app/` 直下や共通ディレクトリに置かない\n- ページ（`page.tsx`）で `<main>` を使用しない\n- 早期リターン（`if (!cond) return`）を使用しない\n- `setTimeout`/`setInterval` は使用しない（待機は `motion.delay` に統一）\n\n---","git":{"commit_hash":"2266298814f70b766cf38426be2312deafb5b6ae","branch":"main","repository_url":"https://github.com/nittastudio/ai-zaiko.git"}}
{"record_type":"state"}
{"type":"message","id":null,"role":"user","content":[{"type":"input_text","text":"model_reasoning_effort=high"}]}
{"record_type":"state"}
{"record_type":"state"}
{"type":"reasoning","id":"rs_68aca614c78881909fd85a433152ed3f072455983b26c1ed","summary":[],"encrypted_content":"gAAAAABorKYme3C-8z02ktjUopsmxD7ldPn-fisbwpdhh4sIP6mLmXJqfrgIDLnW22AnlVSUTlPnwQ5VY9GUw8mBuHwUbkwOcgJUH7zW2_QngPMyivoZ5UBIr5mDdRU_xWeFz0uTH1aLYMJ5-Df-IV164LwUIMu6du59QYh5qV9LzknY-G7BXgaKT0Z3ucmDSjSDFJjoUYh-FStJk6JnYB0AH3Vk_z4ZePDHfJmkLJPrUkaZJQzyB8yt1mCfDgKHEPDLnKIBHkQ5lsupMhD4Tn8O-v0QB8wwjvCx_lGedCR1CBElZ0yysBk2SlG_0KN6p3QNe74TefiRtUqnWeFTaKF0HVMiiLiKeFAMJd7W4azARBBPLxLqWrDmi2Ub-6B8zs2AsnyXH_g5gCUiji5dEIICzujQidEAAV4vrXq2Y2rXvu49oBz2h8RilKrcUzif2NZE4NGNa2H3XeL4Tks4b-A2J3iEW_3qkItPN6tbPs9xI6D_eZ71cj2FUH--sdAs9tRDXkEezLiF1_624N385nVDB68KXBAUid0duYIlRHn7dwBq9eoWhHZcYb-DWynLH13IsaFSerd8ZBQG-n91M4yUSSpw6FejzlAjroOTSnXA9MbopWgaC-6VApUIwoV-9jEnpnpDATTRlxUEp_vxTDv-IjNkmAEFNejucTyFFHN2ZqrMtc4K0NtbtGLwNTYIoU583dmw63m8aPcWHbowsu7mRK62CZLnkTEb0JKl2EVHA4QhjxH0qck8uAR8ntj4qLQfGW7Lq2PkqsszNQE2G_DGYngbvB2ov7TGFzziKwrb2blTtbECl6wGhq1KIOqTO6YuEXwCdJMs4Db-cN40J5MpucZ_DoJI9TTz-lAYYrGTPap1VnqekExzdLGfykt44JoB2DzYUbHNKosPu6_wVLToMsrx8r5PgJE2vatTdOjBnCXkjnd4pr-uTZtxz4kLQBcZLtHCkMZkNtnYr3LlTEate2N43fVIov_p_Z9yG65nnLmbboS6fGlxvYEeQwJX8H_jocbIF8XXfpIyhxOlA-tAIxqjK1_szOoFc2aIAxBDta7Km7XMl0aVSimg-qq92Oy-U9GJX09G9dTpoNYzeRPUstJA__3UMWfSsvXm4PxLaB64J60piMTqiAvCBGEANXGOmRA7tnUgSBml1rU55ZuSbsP7Tvu8IJdxJw5JREmx7TTQUdH5n6pr_sDmxLjXuUA0j9Q0-__ljTXORxnLiniALfJdJluQzAWHm_pTVi4dHthRD79_s93ZwadnlEZccF9LpwIXnqJs7__zZlwxBy4AnHCjCuB-y4bnox1GVlNsDnMR9-3tTe5He_YaYpkayMZ7OUB-7lkAmFJGgpD2pFWzpFBiy1wlh0gRVPYlV9Wt34Cc8FaWNypW-pGlGF1jodj_wTEPCyTCOhkRNBTuCO3RCEyx3TnPz0OBXimW9LJB2mJeLHldGJG0ig7juZPvdWTLIr_Ay_KmDqCAGMzxQ6LLLSNHpX9ThynN9yVHOLFH0iGMW2VjXhVTSuwSTF1ICHPwWdW2iy6CRvGGCAIuzEFloPrLW5X5v8Gk3NFfs36QdnNtsWvNBi4yLUjsfZ0o3Pj9q92O7jHgXvsKmT4h_D6TcZ2_n1eLZo0xxrxBOrbxb9rpV2eBxJPAlRpPqnSVwpwTPfAeks-rlB5-Hlq6ml553li-iEkYHRQ6KI2RiHep0cp_0UDFyVqUM7w6UOoE8-JHOchFjpsIVEyp5cPTZ3q4QtsreKIOLaXOOg0rMJURAbgcGKaHNQG4AQJriev8vP-p0XKYux0Np6rX811R4HA5nxka2FhJfveeZzPDYvCiSceAIwaP21C-h3DbJl_Ah5pwvQhmjzdPMWOaza3sADhY67LJiTNEHWWKtTwOsCoDL9vFZJNXYkoBF1tvXzFZSR9fWDT1ChnMAMAn60263glLX5A7L8hgI3-WeygmuiKok2Fnelvz2PuLN7dnzBrQik9094VGC7cGrJ7ulpBd17ai4pWfKp2vgW_k7zirNkTTLy0qF-ts9dZig5ORzoLrsG3Eq_7A0glqT1m-pgwzMbfEEMbZW6NiJXztNAidWu1qWNTSj8e7z5jklWShLbYKLcmTWMo_z5NamKI8o8L-VN_HrADsT4ceEf2BHw2pK1IraxKBs66D8Cs24YMFSYxccU2kf-FZRIgqHt5b_SsCou0LTZ7z2sGaLd6u-kc_b4f1E-VKXYP0otljC6l5BmS57ti-JAU8qtwAt46HmREguBa00aRjKBu1MiPNefPFX_cuMNj2IaHZG2sFxwfTIn5l5E-ARI0I1Dk7agyYz40yFvN8LJtsUnfrQQwnZIDdZ6KVTAF4B-WLFLpIg4Lgbg4_07Z3MgxSHprpHOPZGYVTBU-lpu1Ic8bPjDyH5PctE6xnaPciO0Fd24-NL0DKDk_8nItdl8lX1vHU-oFdWUtBFO8V3nuDoS49KEi7EDv4esxFAHagc_tkpq_M0g3HP2CtkAVwJW2a2mbFB5Eee947SRhzCcewmlZtdocGkUeZAAOuSS5dcnAQ9JrJ8fh2OiTwiF9Sp9VLzWc7EpYQm_Vv7arYr3u6E6kuXzqGWhqMcnNAON5Deo8dX47JsLACKcMLOPkFdRvdA1HGn18eqGdV_jzQCi5fut18ih6lldbnRi18qETSsrj0YkPq4HHPuU3FmXSBKuY8TKCQiY20JlhSFGLcAu_WGEHNU24OyySpE3ZNcfdMB-oHBXqQiXt-QqYPHO3_9HNU9l-VRxpBYb73YobLifZ8qUddDiOScE7QGXsjYvEBR_CqZ7S2OnpPZravlcrmiXMLKjD42JCEpp272nMEVXqNU5gzKmbIECegoT9fmFSJujJcPDueop28OsfX-MHlEQgvROqS_cQYK67RFH3uvGBJtCZciEeZdfnzIHOLC3iHGhEpJIvQmb-rB1QfEI1GtvY5vaT4NbC2gwc92Vs66031mslg1kXy8WuwBUTer2-PPlOJDN-TVfalLLdpM1okMwWluq2cchi7tfd7TMeARPEjL-3kGmi6mwfYo3BYpbWvy4j0hYAPd1gTtzA-9z47NcNMHNECSdmtyD5PxspWgeknrqq77cTA61I1GVJd9Ob7S7wKVkFpder0p5gLKq5My14CvSeJjCnY7xOscgU_iVzcI30IwOfI9Ly20evx8zLqPpj9q5sUjW0Yl7yVdbXVAilx3FavoLFxPkrNm8HAfaEPDN7Vm2_-ooLdtBwcjnipEubVMWWGpFwcCkHhPo_Mv9ASnP3-lqYSmLx1uJSpUoI0Hvj3wCJ8oK67vrM0SA_n3HYdNkm8kLev3_L7PHDZNQDltEXzAilA8v8vNNPt9iEGNsbTjPdWYZERQY-KgxSTcKjzXbA9sZrU9CKRcTxk0FZmvgJ3fNXq0hsmz9RFiT1W8wN29iDvjqV_jlrCUhtFVvMsyHjzRDnZiCQ6FSetlgYaiia-a5I7SkWolAEXoAvAf_fkikDmWjLPfVoZMit3MO5KplplrNvq10VRsWMjI5jKndjffl02fPH8Xa6oNYMxueDbNRBN7tyh38n_pyA5TonCae9jgCJcnB5rXrHDecPEGXWVIYaP07H6GNH1Yfe8p0wQpZNLPdfAkbOUDdy5jqQ8dya1HDE4M9DTaSbCPAnwVJISOUQt2EUZ8BTOivGl9Vq4cX8NwLy48HYV4oZos8Ajx1SX2IM4RHyiAWmJnshOwF7xIoJ4IGc2VhvOevzs5iIlX6kpB1NEqXdzt7_HQstT3fyE84DzAbRKUB5DKrem2xYuWp1L-QGEAZyJ7tzwvJqUbcvQkSu2a7nuUn7yvNKVIslstj2Z0znAIFbs5Uzhix3a-PR3TsZsiH72qqoS9ftEHzo-aVaAfgQXLzjJazEMrOEUHsnopFX6ENIoM_q508VMv1sYKFI_rz4CCv9RULb9Z0jViuTSc8HOANN68U6PQGNt_owapf3F1YKnLroK-4KFLf1NGCVEGa3BCNigZLRZGs2fqJCOew9ejD6vEwRh9NiODiBFgse_al3R41Xima-WJ_3lKUmpiLAyx7Usj2XYYNuZeXnXSw4q2uzAl_qyKkGmXAzahO92NdrOyGbE-g8J4ylSmWBDE4PvVnL-a5TNqcnLmXzyh7GncopFK2bc3hSBT-78a5jQIB2732-rKSpr0Yw1hTQZSgcFRANJvpIIJsiyD8WfGrNSK96VjhdYc3TL7xNxDEyPSdQNtO4sPkj-enWWHbyCCadmUV2pA_NO-wO6pTZHZVqnRss-dJ2xv_QBCtKqqU317wFmhuz00bETkP83cBhAR79Yuroyu453PXPfD3WuZa_rykdwb6JItJs="}
{"type":"message","id":"msg_68aca6262bac8190a43e1ddcc16c810e072455983b26c1ed","role":"assistant","content":[{"type":"output_text","text":"方針と制約を確認しました。どの作業から進めますか？\n\nすぐ対応できる候補:\n- リポジトリの構成確認と不足設定の洗い出し\n- ESLint/Prettier/tsconfig が規約に合っているか監査・整備\n- App Router 構成の点検（RSC/Client 分離、命名、`app/(home)`）\n- 具体のページ/コンポーネント実装（要件いただければ着手）\n- Motion/Convex の下準備（ID 管理・CRUD 雛形）\n\nまずはリポジトリをざっと走査して現状把握→改善提案から始めてもよいですか？"}]}
