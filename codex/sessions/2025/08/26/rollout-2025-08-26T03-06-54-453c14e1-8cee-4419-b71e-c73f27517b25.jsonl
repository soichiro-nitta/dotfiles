{"id":"453c14e1-8cee-4419-b71e-c73f27517b25","timestamp":"2025-08-26T03:06:54.605Z","instructions":"# Global AGENT Guidance\n\n## Language Policy\n- Always respond in Japanese.（常に日本語で応答してください）\n\n## 基本方針\n\n## 1. コーディング規約（React/TypeScript）\n\n### コンポーネント\n- **arrow function を使用**（function 宣言は原則不使用）\n- **props は展開しない**（不要な `...props` の横流し禁止）\n- **型定義は `type` を使用**（`interface` は不使用。外部ライブラリとの統合時のみ例外）\n- **`any` は使用禁止**（必要なら明示的な型設計を行う）\n- React Hooks は **名前付きインポート**（`React.useState` などの `React.` プレフィックスは不使用）\n- props の型は **インラインで記述**（再利用時のみ `type` を定義）\n- **`forwardRef` は使用しない**（外部ライブラリとの統合時のみ例外）\n- props は **`props.xxx` として明示的に参照**する（分割代入は必要時のみ最小限）\n\n### コード構造\n- **return は最小限に**（単一 return 推奨。複数行は可）\n- **早期リターン禁止・ガードブロック推奨**：`if (!cond) return` は使用せず、`if (cond) { /* 処理 */ }` で包む\n- 条件分岐は **`&&` を優先**（三項は原則不使用。必要時のみ可）\n- 変数/関数は **再利用しないものはインライン**で記述\n- 一度きりのスタイルオブジェクトは **インライン**で指定\n- 一度きりの小関数/定数も **インライン**で記述\n- コンポーネント分割は **過剰に行わない**（責務が明確な場合のみ）\n- ファイル内ローカルのマッピング/補助ロジックは **`__` プレフィックス**で関数に切り出し、**ファイル最下部**に配置\n\n### 一時変数の取り扱い\n- **単回利用の一時変数は作らずインライン化する**\n- 再利用や明確な可読性向上の根拠がない一時変数の導入を禁止\n- **例外**: 値が変わる可能性があるもの（`ref.current`、非同期処理間の状態など）は安全のため一時変数で保持\n\n### コード品質基準\n- 型定義は **インライン化**（別定義は削除。再利用時のみ `type` 定義）\n- 重複パターンは **オブジェクトリテラル**で統合\n- コンポーネントは **単一の return 文**に収束\n- 条件分岐は **オブジェクトインデックス**で置換できないか検討\n\n## 2. 命名規則\n\n### 基本原則（役割優先・ドメイン後置）\n- 役割を先頭に置く（例: state, set, ref, id, key, on/handle, get/add/update/remove）\n- ドメイン名はその後ろに続ける（例: `stateUser`, `refSvg`, `idUser`, `onUserClick`）\n\n### 具体的な命名\n- `useState`: `stateXXX`, `setXXX`（リアクティブな値であることを明示）\n- `useRef`: `refXXX`（カスタムコンポーネントで参照を渡す場合も `refXxx` 形式）\n- 反復処理コールバック（forEach/map/reduce など）の引数は **1–2 文字**（例: `p`, `i`）\n- ドメイン関数: 動詞ベース（例: `get`, `getById`, `add`, `update`, `remove`）\n- ページ/レイアウトの変数名: ページは **`Page`**、レイアウトは **`Layout`** に統一（default export）\n\n## 3. ファイル/フォルダ構成\n\n### App Router の構成\n- 各ページ配下構成（RSC + Client 分離）\n- `page.tsx` は RSC のままに保つ（\"use client\" は付与しない）\n- クライアント側ロジックは `_Client/` へ分離\n- 1 回しか使わない子は **`_` プレフィックス**（例: `_DialogEdit.tsx`）\n\n### レイアウト（トップレベル）\n- `app/layout.tsx` は `<main>` ランドマークで `children` をラップ\n- `<main>` はアプリ全体で一意。ページ（`page.tsx`）側では `<main>` を使用しない\n- トップページ関連は `app/(home)` に集約\n\n### 命名・エクスポート\n- コンポーネント名はパスカルケース\n- 単回利用の子は `_` プレフィックスを付ける\n\n### import / エイリアス\n- `@` は **プロジェクトルート**を指す（`tsconfig.json` の `paths` に準拠）\n- React Hooks は **名前付きインポート**（例: `import { useEffect } from \"react\";`）\n\n## 4. DOM 操作・Motion 統合ルール\n\n### DOM 操作で try/catch を使わない\n- DOM 操作時に `try { … } catch { … }` は使用しない\n- 代わりにガード節での存在確認（例: `if (el) { /* 処理 */ }`）\n- 型の絞り込み（`useRef<HTMLElement | null>` などの適切な型）\n- 例外を握りつぶすような `catch {}` は禁止\n\n### DOM参照ポリシー（IDとrefの使い分け）\n- 単一コンポーネント内のみで完結する一時的な参照: React の `ref` を使用\n- 複数回使う/ページやコンポーネントをまたいで参照・制御する要素: `id`（`app/motion.ts` の ID 管理）を使用\n- 記法ルール: `ref.current` は値が変わる可能性があるため、必ず 1–2 文字の一時変数に代入してから null チェック・使用する\n\n### Motion API 利用規約\n- `@soichiro_nitta/motion` を使用\n- 変化は基本 `transform`/`opacity`（例: `scale`, `translateY`, `rotate`, `opacity`）に限定\n- `motion.delay(sec)` は「待機のみ」を行う。常に `await` を付けて非同期フロー内で使用\n- `setTimeout`/`setInterval` は使用しない（待機は `motion.delay` に統一）\n\n### Motion のプロパティ指定ルール\n- `motion.set` / `motion.to` に、CSS 複合プロパティの `transform` は渡さない\n- 変形は必ず個別キーで指定（`translateX`, `translateY`, `scale`, `rotate` など）\n- 数値・角度・長さは単位付きの文字列で指定（例: `'61px'`, '120deg'`, `'1'`）\n\n### Motion の ID 定義と要素アクセス\n- Motion の ID 管理と DOM 要素アクセスは `ID.XXX.E()` を用いる\n- `querySelector` / `getElementById` 等の直接参照は原則使用しない\n- 存在ガード: DOM 操作前に `const el = ID.XXX.E(); if (el) { /* 処理 */ }` でガード節を使用\n\n## 5. スタイル管理\n\n### コンポーネント内共通スタイル\n- 共通スタイルはファイル内ローカルの `__style` オブジェクトに集約\n- `__style` の各プロパティ名は簡潔に（例: `img`, `wrap`, `title`, `desc`）\n- クラス合成は `class-variance-authority` の `cva` / `cx` を使用\n- `cx` の条件分岐はオブジェクト記法を用いる\n\n### ページ内共通化の方針\n- スタイルのみを切り出す場合: ファイルローカルの `__style` オブジェクトに `cva` で定義\n- 構造やロジックごと共通化する場合: ページ内ローカルコンポーネント `__Component` を作成\n\n## 6. Next.js 固有ルール\n\n### next/image を使用しない\n- Next.js の `next/image` を使用しない\n- 代わりに標準の `<img>` を使用\n- アクセシビリティのため、`alt` は必須\n\n## 7. パッケージ管理\n\n### パッケージマネージャ（pnpm固定）\n- このワークスペースでは **常に pnpm** を使用\n- npm / yarn は使用しない\n- 依存追加は `pnpm add`、開発依存は `pnpm add -D`、インストールは `pnpm install`\n\n## 8. ESLint/Prettier 設定方針\n\n### ESLint\n- ESLint は Flat Config（`eslint.config.mjs`）を使用\n- `@next/next/no-img-element` はオフ\n- import 並び順は `import/order` でアルファベット昇順、グループ単位に改行\n- React Hooks の `rules-of-hooks` は off、`exhaustive-deps` は warn\n- TypeScript は `no-explicit-any: warn`、`consistent-type-imports: error`、`no-unused-vars: warn`\n\n### 特殊制約ルール\n- `**/app/**/page.{js,jsx,ts,tsx}` では `\"use client\"` を禁止（RSC保持）\n- Client → Server/Page の直 import を禁止\n- TS ファイルから `page.tsx` への直 import を禁止\n\n### Prettier\n- `prettier-plugin-tailwindcss` を使用\n- セミコロンなし、シングルクォート使用、トレイリングカンマあり\n\n## 9. コミットメッセージ\n\n### 日本語でのコミットメッセージ\n- コミットメッセージは **原則すべて日本語** で記述\n- 形式は **Conventional Commits** を推奨：`type(scope)?: subject`\n- `subject` は **日本語で簡潔に**（末尾の句点は不要、50文字目安）\n- 例：`feat: ホームページのヒーローセクションを追加`\n\n## 10. Convex 命名規則\n\n- CRUD: `get`, `getById`, `add`, `update`, `remove`\n- 関数名に **ドメイン名は含めない**（例: `api.transactions.updateStatus` のように使用）\n\n## 禁止事項\n\n- `page.tsx` に \"use client\" を付与しない\n- 不要な `...props` の横流しを行わない\n- トップページ専用の要素を `app/` 直下や共通ディレクトリに置かない\n- ページ（`page.tsx`）で `<main>` を使用しない\n- 早期リターン（`if (!cond) return`）を使用しない\n- `setTimeout`/`setInterval` は使用しない（待機は `motion.delay` に統一）\n\n---","git":{"commit_hash":"2266298814f70b766cf38426be2312deafb5b6ae","branch":"main","repository_url":"https://github.com/nittastudio/ai-zaiko.git"}}
{"record_type":"state"}
{"type":"message","id":null,"role":"user","content":[{"type":"input_text","text":"model_reasoning_effort=high"}]}
{"record_type":"state"}
{"record_type":"state"}
{"type":"reasoning","id":"rs_68aca63f97e88196aba6b92eabd1d32d0ea3c9a69e89588c","summary":[],"encrypted_content":"gAAAAABorKZPZO2Y7BWdpiKCnckziWYVN6CZt_atdT4JmU9vLmZfJ3lVNGSn0j6_4jxdyJyNdVVZLI8vkbKDBlQHx3ybgcUOCdYPrMTSFocvWpWURHQ4XBdKjAdYeKkI1CmeqkfMS353oimDJa0y8rrd3ZCbjAp1PDQZTatjHyDoyFIOVlO93Uh8tFCcAb7CWiynpxcl4GACTSNQ4T4gcmYVz4viP7CSgsm5nE9ZwFyLvTk-Yh3C53RT5A7VyEkl2tXJRcy_bMKLGu8i0gUmnTfr9d7Kl5fc5-I8sOStYAQVSrX6Xnom-3zuXVfjWbdztYr2m2hClnUSGi-NqmnGLEDgvQZwDF1e0tGn1fxHawhcNyb1-HdNjNQqSeaxh0355vgNUDD6VtzJ4pAG3bCe4hpV99EgpyliIqDg-10vjkuSWVOTPDJAQheYFQdxIU6f0EnJsfnGa5l_2qUiH0BB9G_KtG1EetCm9StDhLUoBCqzRd4eCz5lunmdN5yTyZgFiLf0006PuOSAGGl4IxIKlNRwJkCA6IG3JGOMpy2W79Q63gaQFvtH-TI-vbHOyk1-qZfbb0t6wSZMej8oKuYUgmINzDbbvxQpXmivAEw_J_TovfvHDxCGceGRTZncsbn6_rTcAwfdN_nIGV85y0R0FQ9MMhLUrgdB1uBdZEF3fozIsKUIIZTebEXJzbW7p3YtcqKUgkNKzFIQGgmzEzbFSJAXts3v1zRQqiaPjtqIRYQ-2ek5pt5HoOHMaUD6-20EHxxbs63cbDr3Yg-TFq-NfxttAxlCB4loOZWxlQOOW6wim2GPrFls2LXUxIFPUUcLoQZkCsH7KoZeldKcbr3YqGkDLIUMpR6XzrfJNvTzJ1VFisV4F5GMafFzcZeOQM7XQM3KpHP3fDF7K_Hjkfi--1GttJfbUYXD1pMSn-1IHKtcRafg_wcTnRzyVryq_p4yMljV3vgHp6QpoMp_-5P3KhP4gBZXB0e6Gb5l8YSzB9CWDN3NZQxYrAu8SU0YJzRB2ALfrVndo1Mj10Ued1KeLlTFXyTZfs4-_r3KxifRo-lGPOEZMAi1Bq7VYD7_ZS8cC2aYoovqW50o-gPo2qPcbtCrQZ8uenI4s5_LOEHf9SzCu29VBusFVLewLWHCZJ82TGBoB7O-xWpvD-AQlI61YSLdCjw5cvoqji2F8MrNPX2rUozii-6epVtuSoR3ZkkkZK0Xao7Ayo8W62bvrYhOdGp9ljTAZveyyTApyr27KdRHgSTCwAQtQW7UOU3N4wCX-E53gI5QmgPYSpOrBkAhaZ-9zOBh1B29DjgFNvOT70rs8KDEz8qHoDe_4f1ZXHTxyHWgvZCGDL3tdtjJv2mY8SQmTvh3tCLJqcR8_RiLEy6Uiwbjbq3jaErkj8U_0Ozdy0mZUJaVX-kk_pju76tn8no4Zqq2bmphzLCXn-mXMBx3fJpnOkLdBhac1eb3AZyqj3OTcQKdctApu5vQI-v6bu_hitnlRUMX38vMAMsTZNcC1HgePLU1f4rz8wZvVTvzXsQ4HO9X7nBJXvuuMqcxFaKUKDuztNRJFwaatAPM10MBbgEUEEjl2g8F8P5CgmJMrRTKrn4ATj26RthCsrEmMk80PGIZrdFl64BVRlQWDMKo5Q9cf4t7EKK9J3cyY3Mm0qZcWttuuJibiPRLOjmC-QS_qlWSposEX8Zkykn467VUYHAatuhSk_M39yDY8EmKjpd9cXZgacOxqbqFPbIwxRojfQxp8TunKHhkj0sS4gwSQp5mn3gQW0VAFTKyz4ebC1i0TV1PxWxA_bGMuvJgmXFDF0C0RC8mLTdCUSEc5ZLhZv_A-G5prqKF08Es9F82BPGgR2FsUGZC4smCsPtPr8KRyd6ESOMymnIecAQtoKaS-VlnFIp-ygvnotVOdE9N2iEqrMTX27FcVEm6DRwj3vEBTPLaAH4eqff3ciC4RmDQkxR3Enm0Dy4_q7O43_LR02V-37KvNAipNPZgywXWLs0RwIhX6zKLCy40OpLnd6qIeZzDh-f53QWRdKcR-nfeNaPVpVgWzTGHZ_uqCqiTJkAdPurObmT9gJmnOKiqFmoXPHS1zjPfEVmzSgB11g8Hig_Tcudp2_9IapwtWAsnNEVHaUM-4W7RqVg5Teml1ChUl0i0AbYpM556iHBd29zBjPbsxlDNP3BldVyRMLDybirH24L-ogqgTSSegWs3iF9OZOeyN3JBxPYa1fs2Ghz_2VU21z7ZkK89zhhZY3VOmnUTIfGY0zavvhSaAgkF9nJjN7jTMt9PPG9f19InNvQSD109EpgZosC4sT45Zmb1YOoyK_PkHbpvUKs6IkbrunYIvl937kKsEK96K3qlcM7Z6asU3Ijebef3w78h_3weAhJfloQ7TiTEsj0qTJ4WDokWU7ioNpT8i6QzSUhA1bkE4DSutd4N4u5l3u0ihcczKdWghLr0lS1dHL7J7RbAnNUsJbx4hXz1yNGh4b_MyDV69z9Ausm1t5rU9Ldi6kKb6N6Nw6NsvluHOFxd0T13w8gdZTo_fqSL1vduF0Qw8syGQ1Le1Y0iSeJKBBHSk-4TAwaBLkiWEiLz972_CFX3f6_BoRfb7FMGwcVv5pVXN5jYBMFcNE52tIDIgogngHtI7mT-8TVntLriWZuaOhZOtcwgJnWpR7ssnBxaiRW9WYE5GQGylnl43PXLkIvZEjwHEA3p5nOC70CXTdRGGaYy_mKULHo65CGwQ__UIGlQ1wQ06BPeRhiku9_qs6j0GQCXiYB2LZb1As6vI98YsVhMjQqZ-KkC5k03SgrP5W_2GFKuVdhVHcnKrMff9v8771ME39QXEuhziqIf2Z8EARZtIR3FHlj8rGSQ9iVhpjq6zXF9yMqmCoseT6y2NygvGYc-yiRune2K4t5K4CJgsVa1Nu4chCM0-s5PMDRYoRcm7u4GTcAewC4EalAQyl4FI5ffjEUvyPvtDuuvKquYa7VJuqse-uSv8SeURrujaZCQCFjHKG1ZXWLF2YshU2qB5Y1L0crZuPRXmAEvnkYHe4mQZCjLNMNSUzeDABAS8ZpxFxuySLaBQHjQoFKqDij3D4t69cO7TRGJywDeZdH9Hm0erKSFE_AKZDv-F8N-guvyvKHXQ56dzp4C6uQV8BaekhMs3Xpm8iquvFDuOORs9peB393ntdKcgQMkJ6KEPalWehtsUsUgo2a9QmS16PTs10R7dhzPmNJ4FvYcbdtkc-gT2QhJ6yABOqrCYkpXXgwoH5wM-hpM4vYC1ToHfIM0g-v7OHIkIyrBkQHyN3xjKt9N1paCmaVexTQptavPegUr0X-kX5trtIVfPFLJSg2ZLMjlDN_suvRVXwKbnR3aIgLDAqiJlWPJxf6mDE-1xU7ZAn-3G-CZYqp7HBYiMSWgybdED7mAarYYXDcMGKDgUHa4MQ-Gh_FGaL3sO0Vb7nq8nXngyY7fudP0rNAthvx1wOM2xUurHcULL-HHoZ7-N-EVeHRjvaeBeo9s72DZWozqXLIkVHjIPtiq-fcOddQB0UOx0_Eca9GT1uFJgCALJuXnt7TIFpLoliJjJYxKIpRffidr8aJH3bgbbZrfiUQkr0xZiOquYDvCZ90gbyi7Co9nKy6MAORf0i6Mjf_IbqbDuUHsFI6ydWiz5X8nnKG5H7SvMTiegtFe2ckn8-oLcj5IlERjIJny84_nnl5ZL-EmLsiEcsPtAq8wKG2sTdcl330SmBkpGdC1dKOKsOCyCJ7VwkF8BpehyOt0po2KzaD5lIHqaOpRbh4A1BAKyzdZFzxji6_mw5u6uO-9AZHVlNe2q-lxZetTQ5LzOg9o-mxQw8JkvXg5yRvSLoB2npunnLYyeVDnz1Bdn4VofbSaHIuLXJKOnICAGO75-m4NfAhudmZOeXkVivAzTZajtDmlYN8zEG9hAz-E5mhHgJYsbMHIE9XFmYFHChAn5A2_0WA2U6RPw-_BJJLl4XNmldAnwnhQjovDbFX2FShhS34Un8Quih3n9GNvIj93kwo4XCJy8l1rOvIKfFLLh9g4w3EtSXkHB1F5B0gY1vfAl_g6fTEPumNMQn5Vx5ZSOzW-Uo2BzvX0IhQSA2dwCuGjCYOFGarPpy-0yQUkz1FRuuTrngDg-7fl79voD7znzDw="}
{"type":"message","id":"msg_68aca64fe81c8196ac1bf3ea858108a40ea3c9a69e89588c","role":"assistant","content":[{"type":"output_text","text":"方針とルール、すべて了解しました。以後は日本語で、記載のコーディング規約に沿って進めます。\n\n次にやりたいことを教えてください。\n- 規約準拠のチェックと整備（ESLint/Prettier/tsconfig/alias/pnpm統一）\n- 新機能の実装やバグ修正\n- Next.js App Router 構成の見直し\n- 既存コードの型安全化・リファクタ\n\nもしよければ、まずリポジトリを一巡して package.json/tsconfig/eslint.config.mjs/app 構成/依存関係を確認し、差分タスクを洗い出します。実行してもよいですか？"}]}
